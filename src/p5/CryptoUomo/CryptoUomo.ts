// CryptoUomo
// Ira Greenberg
// Santa Fe, NM | Dallas, TX
// 2024

// Class Description: 

import p5 from "p5";
import { VerletStick } from "../../libPByte_p5/VerletStick";
import { VerletNode } from "../../libPByte_p5/VerletNode";


export class CryptoUomo {
    p: p5;
    boundary: p5.Vector;

    rand_BM: Random;

    vBlocks: VerletNode[] = [];
    vSticks: VerletStick[] = [];


    // Block pos: xyz
    data = [
        -0.185, -0.129, 0.00,
        -0.185, -0.100, 0.00,
        -0.185, -0.0714, 0.00,
        -0.169, -0.186, 0.00,
        -0.169, -0.157, 0.00,
        -0.169, -0.129, 0.00,
        -0.169, -0.100, 0.00,
        -0.169, -0.0714, 0.00,
        -0.169, -0.0429, 0.00,
        -0.169, -0.0143, 0.00,
        -0.153, -0.186, 0.00,
        -0.153, -0.157, 0.00,
        -0.153, -0.129, 0.00,
        -0.153, -0.100, 0.00,
        -0.153, -0.0714, 0.00,
        -0.153, -0.0429, 0.00,
        -0.153, -0.0143, 0.00,
        -0.153, 0.0143, 0.00,
        -0.137, -0.243, 0.00,
        -0.137, -0.214, 0.00,
        -0.137, -0.186, 0.00,
        -0.137, -0.157, 0.00,
        -0.137, -0.0143, 0.00,
        -0.137, 0.0143, 0.00,
        -0.121, -0.243, 0.00,
        -0.121, -0.214, 0.00,
        -0.121, -0.186, 0.00,
        -0.121, -0.157, 0.00,
        -0.121, -0.0143, 0.00,
        -0.121, 0.0143, 0.00,
        -0.121, 0.443, 0.00,
        -0.104, -0.243, 0.00,
        -0.104, -0.214, 0.00,
        -0.104, -0.186, 0.00,
        -0.104, 0.0143, 0.00,
        -0.104, 0.0429, 0.00,
        -0.104, 0.0714, 0.00,
        -0.104, 0.100, 0.00,
        -0.104, 0.129, 0.00,
        -0.104, 0.186, 0.00,
        -0.104, 0.214, 0.00,
        -0.104, 0.243, 0.00,
        -0.104, 0.271, 0.00,
        -0.104, 0.300, 0.00,
        -0.104, 0.414, 0.00,
        -0.0884, -0.243, 0.00,
        -0.0884, -0.214, 0.00,
        -0.0884, -0.186, 0.00,
        -0.0884, -0.157, 0.00,
        -0.0884, -0.129, 0.00,
        -0.0884, -0.100, 0.00,
        -0.0884, -0.0714, 0.00,
        -0.0884, -0.0429, 0.00,
        -0.0884, -0.0143, 0.00,
        -0.0884, 0.0143, 0.00,
        -0.0884, 0.0429, 0.00,
        -0.0884, 0.0714, 0.00,
        -0.0884, 0.100, 0.00,
        -0.0884, 0.129, 0.00,
        -0.0884, 0.157, 0.00,
        -0.0884, 0.186, 0.00,
        -0.0884, 0.243, 0.00,
        -0.0884, 0.271, 0.00,
        -0.0884, 0.300, 0.00,
        -0.0884, 0.329, 0.00,
        -0.0884, 0.357, 0.00,
        -0.0884, 0.386, 0.00,
        -0.0884, 0.414, 0.00,
        -0.0723, -0.271, 0.00,
        -0.0723, -0.243, 0.00,
        -0.0723, -0.214, 0.00,
        -0.0723, -0.186, 0.00,
        -0.0723, -0.157, 0.00,
        -0.0723, -0.129, 0.00,
        -0.0723, -0.100, 0.00,
        -0.0723, -0.0714, 0.00,
        -0.0723, -0.0429, 0.00,
        -0.0723, -0.0143, 0.00,
        -0.0723, 0.0143, 0.00,
        -0.0723, 0.0429, 0.00,
        -0.0723, 0.0714, 0.00,
        -0.0723, 0.100, 0.00,
        -0.0723, 0.129, 0.00,
        -0.0723, 0.157, 0.00,
        -0.0723, 0.186, 0.00,
        -0.0723, 0.214, 0.00,
        -0.0723, 0.243, 0.00,
        -0.0723, 0.271, 0.00,
        -0.0723, 0.300, 0.00,
        -0.0723, 0.329, 0.00,
        -0.0723, 0.357, 0.00,
        -0.0723, 0.386, 0.00,
        -0.0723, 0.414, 0.00,
        -0.0563, -0.271, 0.00,
        -0.0563, -0.243, 0.00,
        -0.0563, -0.214, 0.00,
        -0.0563, -0.186, 0.00,
        -0.0563, -0.157, 0.00,
        -0.0563, -0.129, 0.00,
        -0.0563, -0.100, 0.00,
        -0.0563, -0.0714, 0.00,
        -0.0563, -0.0429, 0.00,
        -0.0563, -0.0143, 0.00,
        -0.0563, 0.0143, 0.00,
        -0.0563, 0.0429, 0.00,
        -0.0563, 0.0714, 0.00,
        -0.0563, 0.100, 0.00,
        -0.0563, 0.129, 0.00,
        -0.0563, 0.157, 0.00,
        -0.0563, 0.186, 0.00,
        -0.0563, 0.214, 0.00,
        -0.0563, 0.243, 0.00,
        -0.0563, 0.271, 0.00,
        -0.0563, 0.300, 0.00,
        -0.0402, -0.414, 0.00,
        -0.0402, -0.386, 0.00,
        -0.0402, -0.357, 0.00,
        -0.0402, -0.271, 0.00,
        -0.0402, -0.243, 0.00,
        -0.0402, -0.214, 0.00,
        -0.0402, -0.186, 0.00,
        -0.0402, -0.157, 0.00,
        -0.0402, -0.129, 0.00,
        -0.0402, -0.100, 0.00,
        -0.0402, -0.0714, 0.00,
        -0.0402, -0.0429, 0.00,
        -0.0402, -0.0143, 0.00,
        -0.0402, 0.0143, 0.00,
        -0.0402, 0.0429, 0.00,
        -0.0402, 0.0714, 0.00,
        -0.0402, 0.100, 0.00,
        -0.0402, 0.129, 0.00,
        -0.0402, 0.157, 0.00,
        -0.0241, -0.414, 0.00,
        -0.0241, -0.386, 0.00,
        -0.0241, -0.357, 0.00,
        -0.0241, -0.329, 0.00,
        -0.0241, -0.300, 0.00,
        -0.0241, -0.271, 0.00,
        -0.0241, -0.243, 0.00,
        -0.0241, -0.214, 0.00,
        -0.0241, -0.186, 0.00,
        -0.0241, -0.157, 0.00,
        -0.0241, -0.129, 0.00,
        -0.0241, -0.100, 0.00,
        -0.0241, -0.0714, 0.00,
        -0.0241, -0.0429, 0.00,
        -0.0241, -0.0143, 0.00,
        -0.0241, 0.0143, 0.00,
        -0.0241, 0.0714, 0.00,
        -0.00804, -0.414, 0.00,
        -0.00804, -0.386, 0.00,
        -0.00804, -0.357, 0.00,
        -0.00804, -0.329, 0.00,
        -0.00804, -0.300, 0.00,
        -0.00804, -0.271, 0.00,
        -0.00804, -0.243, 0.00,
        -0.00804, -0.214, 0.00,
        -0.00804, -0.186, 0.00,
        -0.00804, -0.157, 0.00,
        -0.00804, -0.129, 0.00,
        -0.00804, -0.100, 0.00,
        -0.00804, -0.0714, 0.00,
        -0.00804, -0.0429, 0.00,
        -0.00804, -0.0143, 0.00,
        -0.00804, 0.0143, 0.00,
        0.00804, -0.414, 0.00,
        0.00804, -0.386, 0.00,
        0.00804, -0.357, 0.00,
        0.00804, -0.329, 0.00,
        0.00804, -0.300, 0.00,
        0.00804, -0.271, 0.00,
        0.00804, -0.243, 0.00,
        0.00804, -0.214, 0.00,
        0.00804, -0.186, 0.00,
        0.00804, -0.157, 0.00,
        0.00804, -0.129, 0.00,
        0.00804, -0.100, 0.00,
        0.00804, -0.0714, 0.00,
        0.00804, -0.0429, 0.00,
        0.00804, -0.0143, 0.00,
        0.00804, 0.0714, 0.00,
        0.0241, -0.414, 0.00,
        0.0241, -0.386, 0.00,
        0.0241, -0.357, 0.00,
        0.0241, -0.329, 0.00,
        0.0241, -0.300, 0.00,
        0.0241, -0.271, 0.00,
        0.0241, -0.243, 0.00,
        0.0241, -0.214, 0.00,
        0.0241, -0.186, 0.00,
        0.0241, -0.157, 0.00,
        0.0241, -0.129, 0.00,
        0.0241, -0.100, 0.00,
        0.0241, -0.0714, 0.00,
        0.0241, -0.0429, 0.00,
        0.0241, -0.0143, 0.00,
        0.0241, 0.0143, 0.00,
        0.0241, 0.0429, 0.00,
        0.0241, 0.0714, 0.00,
        0.0241, 0.100, 0.00,
        0.0241, 0.129, 0.00,
        0.0402, -0.386, 0.00,
        0.0402, -0.357, 0.00,
        0.0402, -0.271, 0.00,
        0.0402, -0.243, 0.00,
        0.0402, -0.214, 0.00,
        0.0402, -0.186, 0.00,
        0.0402, -0.157, 0.00,
        0.0402, -0.129, 0.00,
        0.0402, -0.100, 0.00,
        0.0402, -0.0714, 0.00,
        0.0402, -0.0429, 0.00,
        0.0402, -0.0143, 0.00,
        0.0402, 0.0143, 0.00,
        0.0402, 0.0429, 0.00,
        0.0402, 0.0714, 0.00,
        0.0402, 0.100, 0.00,
        0.0402, 0.129, 0.00,
        0.0402, 0.157, 0.00,
        0.0402, 0.186, 0.00,
        0.0562, -0.271, 0.00,
        0.0562, -0.243, 0.00,
        0.0562, -0.214, 0.00,
        0.0562, -0.186, 0.00,
        0.0562, -0.157, 0.00,
        0.0562, -0.129, 0.00,
        0.0562, -0.100, 0.00,
        0.0562, -0.0714, 0.00,
        0.0562, -0.0429, 0.00,
        0.0562, -0.0143, 0.00,
        0.0562, 0.0143, 0.00,
        0.0562, 0.0429, 0.00,
        0.0562, 0.0714, 0.00,
        0.0562, 0.100, 0.00,
        0.0562, 0.129, 0.00,
        0.0562, 0.186, 0.00,
        0.0562, 0.214, 0.00,
        0.0562, 0.243, 0.00,
        0.0562, 0.271, 0.00,
        0.0562, 0.300, 0.00,
        0.0723, -0.271, 0.00,
        0.0723, -0.243, 0.00,
        0.0723, -0.214, 0.00,
        0.0723, -0.186, 0.00,
        0.0723, -0.157, 0.00,
        0.0723, -0.129, 0.00,
        0.0723, -0.100, 0.00,
        0.0723, -0.0714, 0.00,
        0.0723, -0.0429, 0.00,
        0.0723, -0.0143, 0.00,
        0.0723, 0.0143, 0.00,
        0.0723, 0.0429, 0.00,
        0.0723, 0.0714, 0.00,
        0.0723, 0.100, 0.00,
        0.0723, 0.157, 0.00,
        0.0723, 0.186, 0.00,
        0.0723, 0.214, 0.00,
        0.0723, 0.243, 0.00,
        0.0723, 0.271, 0.00,
        0.0723, 0.300, 0.00,
        0.0723, 0.329, 0.00,
        0.0723, 0.357, 0.00,
        0.0723, 0.386, 0.00,
        0.0723, 0.414, 0.00,
        0.0884, -0.271, 0.00,
        0.0884, -0.243, 0.00,
        0.0884, -0.214, 0.00,
        0.0884, 0.0143, 0.00,
        0.0884, 0.0429, 0.00,
        0.0884, 0.0714, 0.00,
        0.0884, 0.100, 0.00,
        0.0884, 0.129, 0.00,
        0.0884, 0.157, 0.00,
        0.0884, 0.186, 0.00,
        0.0884, 0.214, 0.00,
        0.0884, 0.243, 0.00,
        0.0884, 0.271, 0.00,
        0.0884, 0.300, 0.00,
        0.0884, 0.329, 0.00,
        0.0884, 0.357, 0.00,
        0.0884, 0.386, 0.00,
        0.0884, 0.414, 0.00,
        0.104, -0.243, 0.00,
        0.104, -0.186, 0.00,
        0.104, -0.0143, 0.00,
        0.104, 0.0143, 0.00,
        0.104, 0.0714, 0.00,
        0.104, 0.100, 0.00,
        0.104, 0.129, 0.00,
        0.104, 0.214, 0.00,
        0.104, 0.243, 0.00,
        0.104, 0.414, 0.00,
        0.104, 0.443, 0.00,
        0.121, -0.243, 0.00,
        0.121, -0.214, 0.00,
        0.121, -0.186, 0.00,
        0.121, -0.157, 0.00,
        0.121, -0.0143, 0.00,
        0.121, 0.0143, 0.00,
        0.121, 0.443, 0.00,
        0.137, -0.214, 0.00,
        0.137, -0.186, 0.00,
        0.137, -0.157, 0.00,
        0.137, -0.100, 0.00,
        0.137, -0.0714, 0.00,
        0.137, -0.0429, 0.00,
        0.137, -0.0143, 0.00,
        0.137, 0.443, 0.00,
        0.153, -0.186, 0.00,
        0.153, -0.157, 0.00,
        0.153, -0.129, 0.00,
        0.153, -0.100, 0.00,
        0.153, -0.0714, 0.00,
        0.153, -0.0429, 0.00,
        0.153, -0.0143, 0.00,
        0.169, -0.186, 0.00,
        0.169, -0.157, 0.00,
        0.169, -0.129, 0.00,
        0.169, -0.100, 0.00,
        0.169, -0.0714, 0.00,
        0.185, -0.129, 0.00,
        0.185, -0.100, 0.00
    ];

    // Block cols: rgb
    cols = [
        221, 165, 138, 235, 189, 162, 208, 155, 129, 229, 171, 146, 239, 184, 160, 214, 161, 139, 200, 145, 119, 212, 159, 134, 231, 185, 162, 187, 132, 116, 246, 195, 176, 213, 157, 131, 48, 17, 10, 141, 82, 63, 105, 49, 33, 176, 116, 89, 202, 142, 121, 127, 72, 65, 230, 177, 143, 225, 174, 145, 247, 202, 182, 136, 79, 60, 211, 152, 130, 42, 15, 10, 250, 210, 189, 196, 144, 115, 202, 157, 137, 88, 36, 23, 147, 84, 68, 53, 21, 14, 121, 60, 55, 240, 202, 181, 200, 146, 119, 90, 37, 21, 141, 96, 78, 228, 184, 161, 219, 173, 151, 221, 176, 154, 184, 135, 115, 129, 81, 69, 193, 131, 115, 166, 108, 90, 173, 115, 98, 138, 85, 69, 180, 123, 108, 233, 189, 160, 246, 211, 190, 169, 124, 106, 211, 159, 129, 220, 169, 140, 230, 187, 159, 216, 164, 137, 234, 188, 161, 240, 199, 174, 233, 191, 167, 232, 191, 167, 219, 174, 153, 187, 139, 119, 193, 140, 120, 184, 120, 102, 138, 76, 61, 69, 36, 24, 92, 47, 34, 85, 42, 29, 107, 57, 40, 153, 93, 75, 186, 123, 107, 119, 72, 61, 158, 122, 109, 230, 180, 151, 235, 196, 178, 137, 86, 71, 234, 188, 160, 230, 184, 154, 237, 198, 170, 224, 178, 153, 232, 192, 168, 209, 165, 141, 177, 129, 104, 128, 79, 63, 95, 56, 42, 126, 76, 61, 132, 77, 61, 50, 19, 12, 35, 14, 8, 30, 10, 6, 43, 19, 12, 66, 30, 20, 28, 7, 4, 46, 19, 10, 67, 31, 21, 88, 45, 36, 26, 8, 5, 227, 177, 153, 213, 158, 129, 216, 167, 147, 108, 64, 52, 220, 167, 138, 228, 186, 158, 232, 192, 166, 221, 174, 144, 189, 135, 110, 206, 161, 140, 168, 114, 93, 132, 79, 62, 79, 41, 30, 57, 28, 23, 43, 19, 15, 38, 12, 9, 39, 14, 11, 58, 27, 19, 67, 33, 24, 51, 20, 13, 37, 13, 9, 119, 105, 100, 210, 152, 128, 212, 153, 123, 218, 159, 136, 216, 158, 132, 198, 142, 122, 56, 25, 16, 226, 185, 159, 200, 150, 125, 229, 185, 157, 212, 161, 133, 193, 148, 124, 166, 115, 94, 122, 73, 56, 127, 76, 59, 70, 34, 23, 33, 11, 8, 39, 15, 10, 51, 21, 15, 229, 170, 153, 126, 94, 83, 227, 183, 171, 188, 125, 106, 229, 169, 149, 211, 141, 121, 214, 155, 134, 161, 112, 92, 30, 12, 8, 192, 139, 109, 186, 130, 102, 185, 137, 111, 179, 128, 104, 168, 118, 96, 161, 113, 94, 98, 49, 35, 34, 12, 9, 214, 156, 136, 144, 86, 74, 135, 74, 60, 209, 146, 131, 106, 49, 35, 158, 78, 66, 159, 102, 83, 108, 66, 51, 184, 130, 105, 100, 59, 43, 155, 106, 81, 61, 27, 19, 145, 92, 74, 140, 90, 71, 118, 76, 60, 168, 102, 89, 154, 99, 81, 51, 33, 27, 38, 20, 19, 69, 43, 35, 61, 28, 21, 177, 94, 76, 229, 178, 157, 235, 189, 168, 201, 138, 115, 188, 137, 111, 158, 104, 81, 181, 128, 101, 123, 74, 55, 103, 58, 44, 61, 34, 23, 131, 86, 70, 59, 46, 41, 93, 65, 56, 108, 68, 54, 124, 85, 74, 61, 32, 26, 90, 51, 39, 197, 131, 106, 231, 187, 169, 126, 73, 55, 145, 94, 72, 81, 42, 30, 103, 61, 45, 78, 44, 32, 58, 31, 22, 61, 38, 29, 135, 87, 70, 35, 15, 10, 118, 72, 58, 158, 108, 90, 34, 25, 21, 140, 133, 126, 85, 42, 34, 121, 76, 62, 221, 161, 132, 218, 167, 146, 79, 46, 34, 86, 51, 37, 72, 44, 34, 105, 68, 51, 96, 58, 41, 42, 22, 17, 162, 117, 97, 160, 110, 89, 151, 103, 83, 140, 94, 79, 194, 150, 133, 163, 120, 106, 136, 92, 79, 172, 125, 107, 132, 82, 64, 214, 158, 132, 184, 125, 102, 58, 34, 26, 73, 42, 29, 56, 29, 21, 96, 57, 41, 61, 34, 23, 54, 25, 16, 206, 167, 146, 198, 157, 140, 203, 156, 136, 174, 131, 116, 166, 123, 112, 72, 37, 31, 149, 90, 71, 177, 134, 118, 203, 156, 132, 177, 123, 99, 130, 85, 66, 171, 115, 92, 176, 117, 91, 104, 62, 46, 120, 82, 68, 82, 47, 37, 122, 85, 73, 89, 54, 41, 144, 109, 95, 144, 105, 92, 125, 75, 58, 142, 92, 73, 155, 112, 93, 122, 85, 71, 85, 51, 41, 145, 92, 78, 144, 91, 77, 148, 90, 71, 119, 73, 59, 112, 63, 47, 162, 110, 85, 155, 97, 75, 149, 95, 77, 159, 104, 91, 147, 105, 98, 92, 62, 51, 115, 73, 55, 139, 107, 97, 74, 35, 26, 108, 84, 76, 114, 99, 96, 65, 50, 44, 30, 14, 12, 74, 41, 32, 133, 87, 77, 77, 36, 29, 60, 28, 19, 70, 34, 24, 76, 37, 24, 60, 27, 16, 52, 20, 11, 96, 53, 35, 172, 120, 111, 120, 71, 52, 27, 14, 9, 171, 94, 83, 88, 47, 40, 195, 184, 181, 114, 93, 83, 84, 61, 54, 143, 92, 81, 31, 8, 8, 134, 81, 67, 176, 123, 110, 94, 56, 38, 56, 31, 25, 128, 79, 62, 148, 93, 78, 180, 125, 111, 37, 22, 20, 185, 128, 123, 74, 43, 30, 170, 113, 89, 110, 60, 46, 188, 125, 101, 179, 113, 92, 209, 151, 134, 120, 68, 54, 59, 17, 13, 126, 74, 53, 191, 137, 123, 200, 161, 147, 168, 107, 87, 161, 103, 83, 102, 62, 47, 134, 102, 90, 149, 114, 99, 107, 59, 43, 54, 26, 18, 59, 29, 23, 69, 41, 32, 149, 108, 97, 237, 212, 203
    ];

    constructor(p: p5, freq: number, boundary: p5.Vector, rand_BM: Random) {
        this.p = p;
        this.boundary = boundary;
        this.rand_BM = rand_BM;
        for (let i = 0; i < this.data.length; i += 3) {
            const radScaler = this.rand_BM.random_num(-.001, .001);
            this.vBlocks.push(
                new VerletNode(
                    p,
                    new p5.Vector(this.data[i], this.data[i + 1], this.data[i + 2]), // pos
                    new p5.Vector(.01 + radScaler, .01 * 9 / 16 + radScaler, .01 * 9 / 16 + radScaler),  // radius
                    p.color(this.cols[i] + this.p.int(this.rand_BM.random_num(-15, 15)), this.cols[i + 1] + this.p.int(this.rand_BM.random_num(-15, 15)), this.cols[i + 2] + this.p.int(this.rand_BM.random_num(-15, 15))))); // color
        }

        for (let i = 0, k = 0; i < this.vBlocks.length; i++) {
            for (let j = i; j < this.vBlocks.length; j++) {
                if (k++ % this.p.int(this.rand_BM.random_num(1, 4)) == 0 && i !== j) {
                    this.vSticks.push(new VerletStick(this.p, this.vBlocks[i], this.vBlocks[j], this.rand_BM.random_num(.0006, .001)));
                }
            }
        }

        this.nudge();
    }

    draw() {
        for (let i = 0; i < this.vBlocks.length; i++) {
            this.vBlocks[i].verlet(); this.vBlocks[i].draw();
            this.vBlocks[i].boundsCollide(this.boundary);
        }

        for (let i = 0; i < this.vSticks.length; i++) {
            this.vSticks[i].constrainLen();
            //this.vSticks[i].draw();
        }

        if (this.p.frameCount % 1 === 0) {
            this.vBlocks[this.p.int(this.rand_BM.random_num(this.vBlocks.length))].nudge(new p5.Vector(this.rand_BM.random_num(-.01, .01), this.rand_BM.random_num(-.01, .01), this.rand_BM.random_num(-.01, .01)));
        }
    }

    nudge(): void {
        for (let i = 0; i < this.vBlocks.length; i++) {
            this.vBlocks[i].nudge(new p5.Vector(this.rand_BM.random_num(-.02, .02), this.rand_BM.random_num(-.02, .02), this.rand_BM.random_num(-.02, .02)));
        }
    }

}